<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
		<link href="{{url_for('static',filename='main.css')}}?v=1.0" rel="stylesheet" type="text/css">

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
		<script src='https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js'></script>
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary navbar-scroll">
		  <div class="container-fluid">
		  	<a href='/' class="navbar-brand pe-3 ps-3">RallyRecords</a>
		    <div class="collapse navbar-collapse" id="navbarNav">
		      <ul class="navbar-nav">
		      	<li class="nav-item ps-5">
		          <a class="nav-link ps-5" aria-current="page" href="/">Reset &#x26CC;</a>
		        </li>
		        <li class="nav-item ps-3">
		          <a class="nav-link" aria-current="page" href="{{ referrer }}">&larr; Previous Query</a>
		        </li>

			    {% if name1 == 'none' and name2 == 'none': %}
				    <li class="nav-item dropdown ps-3">
			          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Division</a>
			          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
			          	<li><a class="dropdown-item" href='/results/group=ATP/p1={{ name1 }}/p2={{ name2 }}/surface={{ surface }}/location={{ location }}/country={{ country }}/year={{ year }}/'>ATP</a></li>
			          	<li><a class="dropdown-item" href='/results/group=WTA/p1={{ name1 }}/p2={{ name2 }}/surface={{ surface }}/location={{ location }}/country={{ country }}/year={{ year }}/'>WTA</a></li>
			          </ul>
			        </li>
			    {% endif %}
		        <li class="nav-item dropdown ps-3">
		          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Surface</a>
		          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
		          	{% for item in distinct_surfaces: %}
		            	<li><a class="dropdown-item" href='/results/group={{ mode }}/p1={{name1}}/p2={{name2}}/surface={{item}}/location={{ location }}/country={{ country }}/year={{ year }}/'>{{ item }}</a></li>
		            {% endfor %}
		          </ul>
		        </li>
		        <li class="nav-item dropdown ps-3">
		          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Location</a>
		          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
		          	{% for item in distinct_locations: %}
		            	<li><a class="dropdown-item" href='/results/group={{ mode }}/p1={{ name1 }}/p2={{ name2 }}/surface={{ surface }}/location={{ item }}/country={{ country }}/year={{ year }}/'>{{ item }}</a></li>
		            {% endfor %}
		          </ul>
		        </li>
		   		<li class="nav-item dropdown ps-3">
		          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Year</a>
		          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
		          	{% for item in distinct_years: %}
		            	<li><a class="dropdown-item" href='/results/group={{ mode }}/p1={{ name1 }}/p2={{ name2 }}/surface={{ surface }}/location={{ location }}/country={{ country }}/year={{ item }}/'>{{ item }}</a></li>
		            {% endfor %}
		          </ul>
		        </li>
		      </ul>
		    </div>
		  </div>
		</nav>
		<div class="container mt-3">
			<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
	  			<ol class="breadcrumb">
	  				<li class="breadcrumb-item">Query</li>
	  				<li class="breadcrumb-item">{{ mode }}</li>
	  				{% if name1 != 'none': %}
				    	<li class="breadcrumb-item">{{ name1 }}</li>
	  				{% endif %}
	  				{% if name2 != 'none': %}
				    	<li class="breadcrumb-item">{{ name2 }}</li>
	  				{% endif %}
	  				{% if surface != 'none': %}
				    	<li class="breadcrumb-item">{{ surface }}</li>
	  				{% endif %}
	  				{% if location != 'none': %}
				    	<li class="breadcrumb-item">{{ location }}</li>
	  				{% endif %}
	  				{% if country != 'none': %}
				    	<li class="breadcrumb-item">{{ country }}</li>
	  				{% endif %}
	  				{% if year != 'none': %}
				    	<li class="breadcrumb-item">{{ year }}</li>
	  				{% endif %}
				</ol>
			</nav>
		</div>

		<div class="container mt-5">
			<div class="row">
				<div class="col">
					{% if name1 != 'none' and name2 != 'none': %}
						<h1>{{name1.upper()}}  <img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == name1.upper()].Code.values[0]}}/flat/64.png">  | {{name2.upper()}}  <img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == name2.upper()].Code.values[0]}}/flat/64.png"></h1>

						<h3 class="text-muted">
						{% if surface != 'none': %}
							{{ surface.upper() }}<br>
						{% endif %}
						{% if location != 'none': %}
							{{ location.upper() }}<br>
						{% endif %}
						{% if year != 'none': %}
							{{ year }}<br>
						{% endif %}
						{% if country != 'none': %}
							{{ country }}
							{% set c = countries[countries['Country'] == country].Code.values[0] %} 
							<img src="https://www.countryflags.io/{{c}}/flat/64.png">
						{% endif %}
					</h3>
					{% elif name1 != 'none' and name2 == 'none': %}
						<h2>{{ first_name }}</h2>
						<h1 class="m-0">{{ last_name.upper() }}  <img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == name1.upper()].Code.values[0]}}/flat/64.png"></h1>
						<h3 class="text-muted">{{countries[countries['Name'].str.upper() == name1.upper()].Country.values[0]}}</h3>
					{% endif %}
					
					<hr>
				</div>				
			</div>

			{% if name1 != 'none' and name2 == 'none': %}
				<div class="row">
					<div class="col-md-auto box">
						<p>Record:</p>
						<h3>{{p1_win | length}} - {{p1_loss | length}} 
					</div>
					<div class="col-md-auto box">
						<p>Win Rate:</p>
						<h3>
						{{(100 * (p1_win | length) / ((p1_win | length) + (p1_loss | length))) | round_number}}%
						{% if country != 'none': %}
							{% set c = countries[countries['Country'] == country].Code.values[0] %} 
							vs. players from {{country}} <img src="https://www.countryflags.io/{{c}}/flat/32.png">
						{% endif %}
						</h3>
					</div>
					<div class="col-md-auto box">
						<p>Matches Played ({%if year != 'none': %}in {{year}}{%else%}since 2005{%endif%}):</p>
						<h3>{{(p1_win | length + p1_loss | length) | number_format}}</h3>
					</div>
					<div class="col-md-auto box">
						<p>Average Games per Lost Set:</p>
						<h3>
							{%if p1_loss | length > 0%}
								{% if mode == 'ATP' %}
									{{((pd.to_numeric(p1_loss['L1']).sum() + pd.to_numeric(p1_loss['L2']).sum() + pd.to_numeric(p1_loss['L3']).sum() + pd.to_numeric(p1_loss['L4']).sum() + pd.to_numeric(p1_loss['L5']).sum()) / (pd.to_numeric(p1_loss['Wsets']).sum() + pd.to_numeric(p1_loss['Lsets']).sum())).round(2)}}
								{% elif mode == 'WTA' %}
									{{((pd.to_numeric(p1_loss['L1']).sum() + pd.to_numeric(p1_loss['L2']).sum() + pd.to_numeric(p1_loss['L3']).sum()) / (pd.to_numeric(p1_loss['Wsets']).sum() + pd.to_numeric(p1_loss['Lsets']).sum())).round(2)}}									
								{% endif %}
							{%else%}
								0.00
							{%endif%}
						</h3>
					</div>
				{% if country == 'none': %}
					<div class="col md-auto box">
						<p>Titles:</p>
						<h3>
							{{p1_win[p1_win['Round'] == 'The Final'] | length}}
						</h3>
					</div>
				{% endif %}
					<div class="col md-auto box last">
						<p>Upsets - Been Upsetted:</p>
						<h3>
							{{p1_win[pd.to_numeric(p1_win['WRank']) > pd.to_numeric(p1_win['LRank'])] | length}} - {{p1_loss[pd.to_numeric(p1_loss['WRank']) > pd.to_numeric(p1_loss['LRank'])] | length}}
						</h3>
					</div>
			</div>

			{% elif name1 != 'none' and name2 != 'none': %}
				<div class="row">
					<div class="col">
						<h3>
							{{countries[countries['Name'].str.upper() == name1.upper()].Country.values[0]}} -
							{{countries[countries['Name'].str.upper() == name2.upper()].Country.values[0]}}
						</h3>
					</div>
				</div>
				<div class="row">
					<div class="col md-auto box">
						<p>H2H Record:</p>
						<h3>{{p1 | length}} - {{p2 | length}}</h3>
					</div>
					<div class="col md-auto box">
						<p>Average Sets:</p>
						<h3>{{((pd.to_numeric(data['Wsets']).sum() + pd.to_numeric(data['Lsets']).sum()) / (data | length)).round(2)}}</h3>
					</div>
					<div class="col md-auto box last">
						<p>Championship Matches:</p>
						<h3>{{ data[data['Round'] == 'The Final'] | length }}</h3>
					</div>

				</div>
			{% else %}
				<div class="row">
					<div class="col md-auto box">
						<p>Best Performer:</p>
						<h3>{{data['Winner'].mode()[0]}} ({{data['Winner'].value_counts()[0] | number_format}} wins)</h3>
					</div>
					{% if country != 'none': %}
						<div class='col md-auto box'>
							<p>Country Record:
							<h3>{{data[data['Winner'].isin(nationality)] | length}} - {{data[data['Loser'].isin(nationality)] | length}}.</h3>
						</div>
						<div class='col md-auto box last'>
							<p>Country Win Rate:
							<h3>{{(100 * (data[data['Winner'].isin(nationality)] | length) / (data[data['Winner'].isin(nationality)] | length + data[data['Loser'].isin(nationality)] | length)) | round_number}}%</h3>
						</div>
					{% else %}
						<div class="col md-auto box">
							<p>Upsets:</p>
							<h3>{{ data[pd.to_numeric(data['WRank']) > pd.to_numeric(data['LRank'])] | length | number_format }}
						</div>
						<div class='col md-auto box last'>
							<p>Championship Matches:</p>
							<h3>{{ data[data['Round'] == 'The Final'] | length }}</h3>
						</div>
					{% endif %}
					</div>
				</div>
			{% endif %}
		</div>


		<div class="container mb-5 mt-5">
			<div class="row">
				<div class="col">
					<canvas id="canvas1"></canvas>
				</div>
				<div class="col">
					<canvas id="canvas2"></canvas>
				</div>
			</div>
		</div>
		{% if data | length > 500: %}
			<div class="container">
				<h6 class="text-muted">Results truncated to 500 rows. Make your queries more specific to see more results, faster.</h6>
			</div>
		{% endif %}
		<table class="table table-hover table-striped align-middle">
			<tr>
				<th scope="col" class="w-10 text-center">Tournament</th>
				<th scope="col" class="w-10 text-center">Date</th>
				<th scope="col" class="w-25">Match</th>
				<th scope="col" class="w-10 text-center">Surface</th>
				<th scope="col" class="w-10 text-center">Court</th>
				<th scope="col" class="w-25">Score</th>
				<th scope="col" class="w-10 text-center">Round</th>
			</tr>
			<tbody>
				{% for index, doc in data.head(2500).iterrows():%}
					<tr>
						<td class="text-center"><a href="/results/group={{ mode }}/p1=none/p2=none/surface=none/location={{ doc['Location'] }}/country=none/year=none/">{{doc['Location']}}</a><br>
							{% if mode == 'ATP' %}
								({{doc['Series']}})
							{% elif mode == 'WTA' %}
								({{doc['Tournament']}})
							{% endif %}
						</td>
						<td class="text-center">{{doc['Date']}}</td>
						<td>
							<img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == doc['Winner'].upper()].Code.values[0]}}/flat/24.png">
							<a href="/results/group={{ mode }}/p1={{ doc['Winner'] }}/p2=none/surface=none/location=none/country=none/year=none/">{{doc['Winner']}}</a>  
							{% if doc['WRank'] != '' and doc['WRank'] > 0 %}
							({{doc['WRank'] | int}}) 
							{% elif doc['WRank'] == 0 or doc['WRank'] == '' %}
							(NA) 
							{% endif %}<br>
							<img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == doc['Loser'].upper()].Code.values[0]}}/flat/24.png">
							<a href="/results/group={{ mode }}/p1={{ doc['Loser'] }}/p2=none/surface=none/location=none/country=none/year=none/">{{doc['Loser']}}</a>  
							{% if doc['LRank'] != '' and doc['LRank'] > 0 %}
							({{doc['LRank'] | int}}) 
							{% elif doc['LRank'] == 0 or doc['LRank'] == '' %}
							(NA) 
							{% endif %}
							{% if doc['Comment'] == 'Retired'%} (Ret.) {% endif %}
						</td>
						<td class="text-center">{{doc['Surface']}}</td>
						<td class="text-center">{{doc['Court']}}</td>
						<td>
							{% if (doc['W1'] | string) | length > 0 %}
								{% if mode == 'ATP' %}
									{% set scale = range(1, 6)%}
								{% elif mode == 'WTA' %}
									{% set scale = range(1, 4)%}
								{% endif %}
								{% for i in scale: %}
									{% set w = 'W' ~ i %} 
									{% set l = 'L' ~ i %}
									{% if (doc[w] | string) | length > 0 %}
										<div class="score text-center">
											{% if pd.to_numeric(doc[w]) > pd.to_numeric(doc[l])%}
												<b>{{doc[w]}}</b>
											{% else %}
												{{doc[w]}}
											{% endif %}
										</div>
									{% endif %}
								{% endfor %}
							{% else %}
								Data unavailable.
							{% endif %}
							<br>
							{% if (doc['L1'] | string) | length > 0 %}
								{% if mode == 'ATP' %}
									{% set scale = range(1, 6)%}
								{% elif mode == 'WTA' %}
									{% set scale = range(1, 4)%}
								{% endif %}
								{% for i in scale: %}
									{% set w = 'W' ~ i %} 
									{% set l = 'L' ~ i %}
									{% if (doc[l] | string) | length > 0 %}
										<div class="score text-center">
											{% if pd.to_numeric(doc[l]) > pd.to_numeric(doc[w]) %}
												<b>{{doc[l]}}</b>
											{% else %}
												{{doc[l]}}
											{% endif %}
										</div>
									{% endif %}
								{% endfor %}
							{% else %}
								Data unavailable.
							{% endif %}
						<td class="text-center">{{doc['Round']}}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</body>
	<script>
		var ctx1 = document.getElementById('canvas1').getContext('2d');
		var ctx2 = document.getElementById('canvas2').getContext('2d');
		{% if name1 != 'none' and name2 == 'none' and surface == 'none' and location == 'none' and country == 'none' and year == 'none': %}
			const chart1 = new Chart(ctx1, {
				type: 'line',
				data: 
				{
					labels: ['2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021'],
				  	datasets: [{
				  		label: 'Ranking',
				    	data: [
				    		{%for i in years:%}
				    			{% set year_sub_win = p1_win[p1_win['Date'].str[-4:] == i] %}
				    			{% set year_sub_loss = p1_loss[p1_loss['Date'].str[-4:] == i] %}
				    			{% if (year_sub_win | length > 0) or (year_sub_loss | length > 0) %}
				    				{% set min_win = ('0' + year_sub_win.WRank.min() | string) | int %}
				    				{% set min_loss = ('0' + year_sub_loss.LRank.min() | string) | int %}
				    				{% if min_win > 0 or min_loss > 0 %}
				    					{% if min_win < min_loss: %}
				    						{% if min_win > 0 %}
				    							{{min_win}},
				    						{% endif %}
				    					{% elif min_loss <= min_win: %}
				    						{% if min_loss > 0 %}
				    							{{min_loss}},
				    						{% endif %}
				    					{% endif %}
				    				{% else %}
				    					NaN,
				    				{% endif %}
				    			{%else%}
				    				NaN,
				    			{%endif%}
				    		{%endfor%}
				    		],
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534',
				    	borderColor: '#053C5E',
				    	lineTension: 0,
				    	fill: false,
					},
					],
				},
				options: {
					title: {
						display: true,
						text: "Rank over Time"
					},
					legend: {
						display: false
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				    			reverse: true,
				        		beginAtZero: true
				        	}
				      	}]
				    }}});
			const chart2 = new Chart(ctx2, {
				type: 'bar',
				data: 
				{
					labels: ['Hard', 'Clay', 'Grass', 'Carpet'],
				  	datasets: [
				  	{
				  		label: 'Wins',
				    	data: 
				    	[
				    		{%if p1_win[p1_win['Surface'] == 'Hard'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Hard']  | length}},
				    		{%endif%}
				    		{%if p1_win[p1_win['Surface'] == 'Clay'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Clay']  | length}},
				    		{%endif%}
				    		{%if p1_win[p1_win['Surface'] == 'Grass'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Grass'] | length}},
				    		{%endif%}
				    		{%if p1_win[p1_win['Surface'] == 'Carpet'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Carpet'] | length}},
				    		{%endif%}
				    	],
				    	borderWidth: 1,
				    	backgroundColor: '#517664'
					},
					{
						label: 'Losses',
						data:
						[
							{%if p1_loss[p1_loss['Surface'] == 'Hard'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Hard']  | length}},
				    		{%endif%}
				    		{%if p1_loss[p1_loss['Surface'] == 'Clay'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Clay']  | length}},
				    		{%endif%}
				    		{%if p1_loss[p1_loss['Surface'] == 'Grass'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Grass'] | length}},
				    		{%endif%}
				    		{%if p1_loss[p1_loss['Surface'] == 'Carpet'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Carpet'] | length}},
				    		{%endif%}
				    	],
				    	borderWidth: 1,
				    	backgroundColor: '#F08080'
					}]
				},
				options: {
					responsive: true,
					title: {
						display: true,
						text: "Record by Surface"
					},
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	}
				      	}]
				    }}});
		{% elif name1 != 'none' and name2 == 'none': %}
			const chart1 = new Chart(ctx1, {
				type: 'bar',
				data: 
				{
					labels: [
						{% for i in range(6): %}
							{% if i < data.loc[data['WRank'] > data['LRank'], "Loser"].value_counts().index | length %}
								{% if data.loc[data['WRank'] > data['LRank'], "Loser"].value_counts().index[i].upper() != name1.upper() %}
								'{{data.loc[data['WRank'] > data['LRank'], "Loser"].value_counts().index[i]}}',
								{% endif %}
							{% endif %}
						{% endfor %}
					],
				  	datasets: [
				  		{
					    	data: [
					    	{%for i in range(6):%}
					    		{% if i < data.loc[data['WRank'] > data['LRank'], "Loser"].value_counts().index | length %}
					    			{%if data.loc[data['WRank'] > data['LRank'], "Loser"].value_counts().index[i].upper() != name1.upper()%}
					    				{{data.loc[data['WRank'] > data['LRank'], "Loser"].value_counts()[i]}},
					    			{%endif%}
					    		{% endif %}
					    	{%endfor%}
					    	],
					    	backgroundColor: '#FE8534',
					    	borderWidth: 1,
						},
					],
				},
				options: {
					title: {
						display: true,
						text: "Upset Breakdown"
					},
					legend: {display: false},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	},
				        	scaleLabel: {
				        		display: true,
				        		labelString: 'Wins over {{ name1 }}'
				        	}
				      	}]
				    }}});
			const chart2 = new Chart(ctx2, {
				type: 'bar',
				data: 
				{
					labels: [
						{% for i in range(6): %}
							{% if i < data["Loser"].value_counts().index | length %}
								{% if data["Loser"].value_counts().index[i].upper() != name1.upper() %}
								'{{data["Loser"].value_counts().index[i]}}',
								{% endif %}
							{% endif %}
						{% endfor %}
					],
				  	datasets: [
				  		{
					    	data: [
					    	{%for i in range(6):%}
					    		{% if i < data["Loser"].value_counts().index | length %}
					    			{%if data["Loser"].value_counts().index[i].upper() != name1.upper()%}
					    				{{data["Loser"].value_counts()[i]}},
					    			{%endif%}
					    		{% endif %}
					    	{%endfor%}
					    	],
					    	backgroundColor: '#FE8534',
					    	borderWidth: 1,
						},
					],
				},
				options: {
					title: {
						display: true,
						text: "Favorable Matchup Breakdown"
					},
					legend: {display: false},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	},
				        	scaleLabel: {
				        		display: true,
				        		labelString: 'Losses to {{ name1 }}'
				        	}
				      	}]
				    }
				}});
		{% elif name1 != 'none' and name2 != 'none' and surface == 'none' and location == 'none' and country == 'none' and year == 'none': %}
			const chart1 = new Chart(ctx1, {
				type: 'bar',
				data: 
				{
					labels: {{data['Location'].value_counts().index.tolist()[0 : 6] | safe}},
				  	datasets: [
				  	{
				  		label: 'Matches Played',
				    	data: {{data['Location'].value_counts().tolist()[0 : 6]}},
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534',
				    	borderColor: '#FE8534',
				    	lineTension: 0,
				    	fill: false,
					},
					]
				},
				options: {
					title: {
						display: true,
						text: "Matches by Location"
					},
					legend: {
						display: false,
					},
					responsive: true,
					scales: {
					   	yAxes: [{
					   		ticks: {
					       		beginAtZero: true
					       	}
					    }]
					}
				}});
			const chart2 = new Chart(ctx2, {
				type: 'bar',
				data: 
				{
					labels: ['Hard', 'Clay', 'Grass', 'Carpet'],
				  	datasets: [{
				  		label: '{{name1.upper()}}',
				    	data: [
				    		{%if p1[p1['Surface'] == 'Hard'] | length > 0 %}
				    			{{p1[p1['Surface'] == 'Hard']  | length}},
				    		{%endif%}
				    		{%if p1[p1['Surface'] == 'Clay'] | length > 0 %}
				    			{{p1[p1['Surface'] == 'Clay']  | length}},
				    		{%endif%}
				    		{%if p1[p1['Surface'] == 'Grass'] | length > 0 %}
				    			{{p1[p1['Surface'] == 'Grass'] | length}},
				    		{%endif%}
				    		{%if p1[p1['Surface'] == 'Carpet'] | length > 0 %}
				    			{{p1[p1['Surface'] == 'Carpet'] | length}},
				    		{%endif%}
				    		],
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534'
					},
					{
						label: '{{name2.upper()}}',
				        data: [
				        	{%if p2[p2['Surface'] == 'Hard'] | length > 0 %}
				    			{{p2[p2['Surface'] == 'Hard']  | length}},
				    		{%endif%}
				    		{%if p2[p2['Surface'] == 'Clay'] | length > 0 %}
				    			{{p2[p2['Surface'] == 'Clay']  | length}},
				    		{%endif%}
				    		{%if p2[p2['Surface'] == 'Grass'] | length > 0 %}
				    			{{p2[p2['Surface'] == 'Grass'] | length}},
				    		{%endif%}
				    		{%if p2[p2['Surface'] == 'Carpet'] | length > 0 %}
				    			{{p2[p2['Surface'] == 'Carpet'] | length}},
				    		{%endif%}
				        ],
				        borderWidth: 1,
				        backgroundColor: '#053C5E'
				    }]
				},
				options: {
					title: {
						display: true,
						text: "Wins by Surface"
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	}
				      	}]
				    }
				}});
		{% elif name1 != 'none' and name2 != 'none': %}
			const chart1 = new Chart(ctx1, {
				type: 'bar',
				data: 
				{
					labels: ['Tiebreak Wins'],
				  	datasets: [{
				  		label: '{{name1.upper()}}',
				    	data: [
				    		{{ p1.loc[p1['W1'] == 7] | length + p1.loc[p1['W2'] == 7] | length + p1.loc[p1['W3'] == 7] | length + p1.loc[p1['W4'] == 7] | length + p1.loc[p1['W5'] == 7] | length }},
				    		],
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534'
					},
					{
						label: '{{name2.upper()}}',
				        data: [
				    		{{ p2.loc[p2['W1'] == 7] | length + p2.loc[p2['W2'] == 7] | length + p2.loc[p2['W3'] == 7] | length + p2.loc[p2['W4'] == 7] | length + p2.loc[p2['W5'] == 7] | length }}				    		
				        ],
				        borderWidth: 1,
				        backgroundColor: '#053C5E'
				    }]
				},
				options: {
					title: {
						display: true,
						text: "Wins in Tiebreak Sets"
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	},
				        	scaleLabel: {
				        		display: true,
				        		labelString: "Count"
				        	}
				      	}]
				    }}});
			const chart2 = new Chart(ctx2, {
				type: 'bar',
				data: 
				{
					labels: ['Best of 3', 'Best of 5'],
				  	datasets: [{
				  		label: '{{name1.upper()}}',
				    	data: [
				    		{{ p1.loc[p1['Best of'] == 3] | length }},
				    		{{ p1.loc[p1['Best of'] == 5] | length }}
				    		],
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534'
					},
					{
						label: '{{name2.upper()}}',
				        data: [
				    		{{ p2.loc[p2['Best of'] == 3] | length }},
				    		{{ p2.loc[p2['Best of'] == 5] | length }}				    		
				        ],
				        borderWidth: 1,
				        backgroundColor: '#053C5E'
				    }]
				},
				options: {
					title: {
						display: true,
						text: "Wins by Match Type"
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	},
				        	scaleLabel: {
				        		display: true,
				        		labelString: "Wins"
				        	}
				      	}]
				    }}});
		{% elif name1 == 'none' and name2 == 'none' and year != 'none' %}
			const chart1 = new Chart(ctx1, {
				type: 'line',
				data: 
				{
					labels: ['2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021'],
				  	datasets: [{
				  		label: '',
				    	data: [
				    		{%for i in years:%}
				    			{% set year_sub = data[data['Date'].str[-4:] == i] | length %}
				    			{%if year_sub > 0 %}
				    				{{year_sub}},
				    			{%else%}
				    				0,
				    			{%endif%}
				    		{%endfor%}
				    		],
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534',
				    	borderColor: '#053C5E',
				    	lineTension: 0,
				    	fill: false,
					}],
				},
				options: {
					title: {
						display: true,
						text: "Matches Played"
					},
					legend: {
						display: false
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	}
				      	}]
				    }
				}});
			const chart2 = new Chart(ctx2, {
				type: 'bar',
				data: 
				{
					labels: [
						{%for i in range(15):%}
							{% if country is none: %}
								'{{data["Winner"].value_counts().index[i]}}',
							{% else %}
								{% if data['Winner'].value_counts().index[i] in nationality %}
									'{{data["Winner"].value_counts().index[i]}}',
								{% endif %}
							{% endif %}
						{%endfor%}
					],
				  	datasets: [
				  		
				  		{
					    	data: [
					    	{%for i in range(15):%}
							{% if country is none: %}
								{{data["Winner"].value_counts()[i]}},
							{% else %}
								{% if data['Winner'].value_counts().index[i] in nationality %}
									{{data["Winner"].value_counts()[i]}},
								{% endif %}
							{% endif %}
						{%endfor%}
					    	],
					    	backgroundColor: '#FE8534',
					    	borderWidth: 1,
						},
					],
				},
				options: {
					title: {
						display: true,
						text: "Best Performers by Wins"
					},
					legend: {
						display: false
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	}
				      	}]
				    }
				}});
		{% elif name1 == 'none' and name2 == 'none' and year == 'none' %}
			const chart1 = new Chart(ctx1, {
				type: 'line',
				data: 
				{
					labels: ['2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021'],
				  	datasets: [{
				  		label: '',
				    	data: [
				    		{%for i in years:%}
				    			{% set year_sub = data[data['Date'].str[-4:] == i] %}
				    			{% if year_sub | length > 0 %}
				    				{% set year_sub2 = year_sub[year_sub['WRank'] != ''] %}
				    				{% set year_sub2 = year_sub2[year_sub2['LRank'] != ''] %}
				    				{{ 100 * (year_sub2[year_sub2['WRank'] > year_sub2['LRank']] | length / year_sub | length) | round_number}},
				    			{%else%}
				    				0,
				    			{%endif%}
				    		{%endfor%}
				    		],
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534',
				    	borderColor: '#053C5E',
				    	lineTension: 0,
				    	fill: false,
					}],
				},
				options: {
					title: {
						display: true,
						text: "% Upsets, by Year"
					},
					legend: {
						display: false
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        	},
				        	scaleLabel: {
				        		display: true,
				        		labelString: '% Upsets of Total Matches'
				        	}
				      	}]
				    }
				}});
			const chart2 = new Chart(ctx2, {
				type: 'bar',
				data: 
				{
					labels: [
						{%for i in range(15):%}
							{% if country is none: %}
								'{{data["Winner"].value_counts().index[i]}}',
							{% else %}
								{% if data['Winner'].value_counts().index[i] in nationality %}
									'{{data["Winner"].value_counts().index[i]}}',
								{% endif %}
							{% endif %}
						{%endfor%}
					],
				  	datasets: [
				  		
				  		{
					    	data: [
					    	{%for i in range(15):%}
							{% if country is none: %}
								{{data["Winner"].value_counts()[i]}},
							{% else %}
								{% if data['Winner'].value_counts().index[i] in nationality %}
									{{data["Winner"].value_counts()[i]}},
								{% endif %}
							{% endif %}
						{%endfor%}
					    	],
					    	backgroundColor: '#FE8534',
					    	borderWidth: 1,
						},
					],
				},
				options: {
					title: {
						display: true,
						text: "Best Performers by Wins"
					},
					legend: {
						display: false
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	}
				      	}]
				    }
				}});
		{% else %}
			console.log('Something went wrong!')
		{% endif %}
	</script>
</html>