<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">


		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
		<link href="{{url_for('static',filename='main.css')}}?v=1.0" rel="stylesheet" type="text/css">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
		<script src='https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js'></script>
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
		  <div class="container-fluid">
		    <div class="collapse navbar-collapse" id="navbarNav">
		      <ul class="navbar-nav">
		        <li class="nav-item">
		          <a class="nav-link" aria-current="page" href="/">&larr; Back</a>
		        </li>
		        <li class="nav-item">
		          <a class="nav-link" href="/player/{{name1}}">{{name1.upper()}}</a>
		        </li>
		      </ul>
		    </div>
		  </div>
		</nav>

		<div class="container mt-5">
			<div class="row">
				<div class="col">
					<h1>{{name1.upper()}}  <img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == name1.upper()].Code.values[0]}}/flat/64.png"></h1>
					<h3 class="text-muted">{{countries[countries['Name'].str.upper() == name1.upper()].Country.values[0]}}</h3>
					<h3 class="text-muted">
						{%if surface | length > 0:%}
							{{surface.upper()}}
						{%endif%}
						{%if location |length > 0:%}
							/ {{location.upper()}}
						{%endif%}
						{%if year | length > 0:%}
							/ {{year}}
						{%endif%}
					</h3>
				</div>				
			</div>
			<div class="row">
				<div class="col">
					<h3>{{p1_win | length}} - {{p1_loss | length}} 
					({{(100 * (p1_win | length) / ((p1_win | length) + (p1_loss | length))) | round_number}}% win rate)</h3>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<h3 class="text-muted">
						{{(p1_win | length + p1_loss | length) | number_format}} matches 
						{%if year | length > 0%}
							in {{year}}.
						{%else%}
							played since 2005.
						{%endif%}
					</h3>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<h4 class="text-muted">
						Wins 
						{%if p1_win | length > 0%}
							{{((pd.to_numeric(p1_win['W1']).sum() + pd.to_numeric(p1_win['W2']).sum() + pd.to_numeric(p1_win['W3']).sum() + pd.to_numeric(p1_win['W4']).sum() + pd.to_numeric(p1_win['W5']).sum()) / (pd.to_numeric(p1_win['Wsets']).sum() + pd.to_numeric(p1_win['Lsets']).sum())).round(2)}}
						{%else%}
						0.00
						{%endif%}
						games in a set on average when the outcome is a win.
					</h4>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<h4 class="text-muted">
						Wins 
						{%if p1_loss | length > 0%}
							{{((pd.to_numeric(p1_loss['L1']).sum() + pd.to_numeric(p1_loss['L2']).sum() + pd.to_numeric(p1_loss['L3']).sum() + pd.to_numeric(p1_loss['L4']).sum() + pd.to_numeric(p1_loss['L5']).sum()) / (pd.to_numeric(p1_loss['Wsets']).sum() + pd.to_numeric(p1_loss['Lsets']).sum())).round(2)}}
						{%else%}
							0.00
						{%endif%}
						games in a set on average when the outcome is a loss.
					</h4>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<h4 class="text-muted">
						Has upset others {{p1_win[pd.to_numeric(p1_win['WRank']) > pd.to_numeric(p1_win['LRank'])] | length}} times, been upset {{p1_loss[pd.to_numeric(p1_loss['WRank']) > pd.to_numeric(p1_loss['LRank'])] | length}} times.
					</h4>
				</div>
			</div>
		</div>

		<div class="container mb-5 mt-5">
			<div class="row">
					{%if surface | length == 0%}
						<div class="col">
							<canvas id="surface"></canvas>
						</div>
					{%endif%}
					{%if year | length == 0%}
						<div class="col">
							<canvas id="rank"></canvas>
						</div>
					{%endif%}
					{% if year | length > 0 or surface | length > 0%}
						<div class="col">
							<canvas id="winners"></canvas>
						</div>
					{%endif%}
			</div>
		</div>

		{% if data | length > 5000: %}
			<div class="container">
				<h6 class="text-muted">Results truncated to 2,500 rows. Make your queries more specific to see more results, faster.</h6>
			</div>
		{% endif %}

		<table class="table table-hover table-striped align-middle">
			<tr>
				<th scope="col" class="w-10 text-center">Tournament</th>
				<th scope="col" class="w-10 text-center">Date</th>
				<th scope="col" class="w-25">Match</th>
				<th scope="col" class="w-10 text-center">Surface</th>
				<th scope="col" class="w-10 text-center">Court</th>
				<th scope="col" class="w-25">Score</th>
				<th scope="col" class="w-10 text-center">Round</th>
			</tr>
			<tbody>
				{% for index, doc in data.head(2500).iterrows():%}
				<tr>
					<td class="text-center"><a href="/results/location/{{doc['Location']}}">{{doc['Location']}}</a><br>({{doc['Series']}})</td>
					<td class="text-center">{{doc['Date']}}</td>
					<td>
						<img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == doc['Winner'].upper()].Code.values[0]}}/flat/24.png">
						<a href="/results/player/{{doc['Winner']}}">{{doc['Winner']}}</a>  
						{% if doc['WRank'] != '' and doc['WRank'] > 0 %}
						({{doc['WRank']}}) 
						{% elif doc['WRank'] == 0 or doc['WRank'] == '' %}
						(NA) 
						{% endif %}<br>
						<img src="https://www.countryflags.io/{{countries[countries['Name'].str.upper() == doc['Loser'].upper()].Code.values[0]}}/flat/24.png">
						<a href="/results/player/{{doc['Loser']}}">{{doc['Loser']}}</a>  
						{% if doc['LRank'] != '' and doc['LRank'] > 0 %}
						({{doc['LRank']}}) 
						{% elif doc['LRank'] == 0 or doc['LRank'] == '' %}
						(NA) 
						{% endif %}
						{% if doc['Comment'] == 'Retired'%} (Ret.) {% endif %}
					</td>
					<td class="text-center">{{doc['Surface']}}</td>
					<td class="text-center">{{doc['Court']}}</td>
					<td>
						{% if (doc['W1'] | string) | length > 0 %}
							{% for i in range(1, 6): %}
								{% set w = 'W' ~ i %} 
								{% set l = 'L' ~ i %}
								{% if (doc[w] | string) | length > 0 %}
									<div class="score text-center">
										{% if pd.to_numeric(doc[w]) > pd.to_numeric(doc[l])%}
											<b>{{doc[w]}}</b>
										{% else %}
											{{doc[w]}}
										{% endif %}
									</div>
								{% endif %}
							{% endfor %}
						{% else %}
							Data unavailable.
						{% endif %}
						<br>
						{% if (doc['L1'] | string) | length > 0 %}
							{% for i in range(1, 6): %}
								{% set w = 'W' ~ i %} 
								{% set l = 'L' ~ i %}
								{% if (doc[l] | string) | length > 0 %}
									<div class="score text-center">
										{% if pd.to_numeric(doc[l]) > pd.to_numeric(doc[w])%}
											<b>{{doc[l]}}</b>
										{% else %}
											{{doc[l]}}
										{% endif %}
									</div>
								{% endif %}
							{% endfor %}
						{% else %}
							Data unavailable.
						{% endif %}
					<td class="text-center">{{doc['Round']}}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</body>

	<script>
		{%if surface | length == 0%}
			var ctx1 = document.getElementById('surface').getContext('2d');
			const chart1 = new Chart(ctx1, {
				type: 'bar',
				data: 
				{
					labels: ['Hard', 'Clay', 'Grass', 'Carpet'],
				  	datasets: [
				  	{
				  		label: 'Wins',
				    	data: 
				    	[
				    		{%if p1_win[p1_win['Surface'] == 'Hard'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Hard']  | length}},
				    		{%endif%}
				    		{%if p1_win[p1_win['Surface'] == 'Clay'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Clay']  | length}},
				    		{%endif%}
				    		{%if p1_win[p1_win['Surface'] == 'Grass'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Grass'] | length}},
				    		{%endif%}
				    		{%if p1_win[p1_win['Surface'] == 'Carpet'] | length > 0 %}
				    			{{p1_win[p1_win['Surface'] == 'Carpet'] | length}},
				    		{%endif%}
				    	],
				    	borderWidth: 1,
				    	backgroundColor: '#517664'
					},
					{
						label: 'Losses',
						data:
						[
							{%if p1_loss[p1_loss['Surface'] == 'Hard'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Hard']  | length}},
				    		{%endif%}
				    		{%if p1_loss[p1_loss['Surface'] == 'Clay'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Clay']  | length}},
				    		{%endif%}
				    		{%if p1_loss[p1_loss['Surface'] == 'Grass'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Grass'] | length}},
				    		{%endif%}
				    		{%if p1_loss[p1_loss['Surface'] == 'Carpet'] | length > 0 %}
				    			{{p1_loss[p1_loss['Surface'] == 'Carpet'] | length}},
				    		{%endif%}
				    	],
				    	borderWidth: 1,
				    	backgroundColor: '#F08080'
					}]
				},
				options: {
					responsive: true,
					title: {
						display: true,
						text: "Record by Surface"
					},
					scales: {
				    	yAxes: [{
				    		ticks: {
				        		beginAtZero: true
				        	}
				      	}]
				    }
				}
			});
		{%endif%}
		{%if year | length > 0 or surface | length > 0%}
			var ctx2 = document.getElementById('winners').getContext('2d');
			const chart2 = new Chart(ctx2, {
			type: 'bar',
			data: 
			{
				labels: [
					{%for i in range(6):%}
						{%if data["Loser"].value_counts().index[i].upper() != name1.upper()%}
						'{{data["Loser"].value_counts().index[i]}}',
						{%endif%}
					{%endfor%}
				],
			  	datasets: [
			  		
			  		{
				    	data: [
				    	{%for i in range(6):%}
				    		{%if data["Loser"].value_counts().index[i].upper() != name1.upper()%}
				    			{{data["Loser"].value_counts()[i]}},
				    		{%endif%}
				    	{%endfor%}
				    	],
				    	backgroundColor: '#FE8534',
				    	borderWidth: 1,
					},
				],
			},
			options: {
				title: {
					display: true,
					text: "Most Wins Against"
				},
				legend: {display: false},
				responsive: true,
				scales: {
			    	yAxes: [{
			    		ticks: {
			        		beginAtZero: true
			        	}
			      	}]
			    }
			}
		});
		{%endif%}
		{%if year | length == 0%}
			var ctx3 = document.getElementById('rank').getContext('2d');
			const chart3 = new Chart(ctx3, {
				type: 'line',
				data: 
				{
					labels: ['2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021'],
				  	datasets: [{
				  		label: 'Ranking',
				    	data: [
				    		{%for i in years:%}
				    			{% set year_sub_win = p1_win[p1_win['Date'].str[-4:] == i] %}
				    			{% set year_sub_loss = p1_loss[p1_loss['Date'].str[-4:] == i] %}
				    			{% if (year_sub_win | length > 0) or (year_sub_loss | length > 0) %}
				    				
				    				{% set min_win = ('0' + year_sub_win.WRank.min() | string) | int %}
				    				{% set min_loss = ('0' + year_sub_loss.LRank.min() | string) | int %}
				    				{{ min_win | debug }}
				    				{{ min_loss | debug }}
				    				{% if min_win > 0 or min_loss > 0 %}
				    					{% if min_win < min_loss: %}
				    						{% if min_win > 0 %}
				    							{{min_win}},
				    						{% endif %}
				    					{% elif min_loss <= min_win: %}
				    						{% if min_loss > 0 %}
				    							{{min_loss}},
				    						{% endif %}
				    					{% endif %}
				    				{% else %}
				    					NaN,
				    				{% endif %}
				    			{%else%}
				    				NaN,
				    			{%endif%}
				    		{%endfor%}
				    		],
				    	borderWidth: 1,
				    	backgroundColor: '#FE8534',
				    	borderColor: '#053C5E',
				    	lineTension: 0,
				    	fill: false,
					},
					],
				},
				options: {
					title: {
						display: true,
						text: "Rank over Time"
					},
					legend: {
						display: false
					},
					responsive: true,
					scales: {
				    	yAxes: [{
				    		ticks: {
				    			reverse: true,
				        		beginAtZero: true
				        	}
				      	}]
				    }
				}
			});
		{%endif%}
	</script>
</html>